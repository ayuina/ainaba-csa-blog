---
layout: default
title: Azure Logic Apps の見積もり
---

## はじめに

Azure のサーバーレスサービスの１つである
[Logic Apps](https://azure.microsoft.com/ja-jp/services/logic-apps/)
の
[料金表](https://azure.microsoft.com/ja-jp/pricing/details/logic-apps/)
を見ると１つ１つの課金単位が極めて細かく、また
[価格モデル](https://docs.microsoft.com/ja-jp/azure/logic-apps/logic-apps-pricing)
の説明を見ても、結局いくらかかるのかがいまいちわかりません。
実行頻度の低いワークフローであれば（他のサービス利用に比べて）誤差の範囲と考えてしまうというのも１つですが、
やはり初回の請求が来るまでドキドキしながら待つというのも精神衛生上あまりよろしくありません。
もちろん真面目にチクチク積み上げてもいいのですが、結果が１円程度未満とかに収まってしまったりすると、その見積もりの労力に対して激しい徒労感に襲われます。
個人的にはこの手のサーバーレス形のサービスはあまり真面目に見積もるよりも、むしろさっさと簡易的な実装してしまって実稼働データを元に料金予測を立てるべきだと思います。

というわけで本ドキュメントでは Logic Apps の料金見積もり手法についてご紹介したいと思います。

## 題材となるワークフロー

ここでは下記の様なワークフローを題材に見積もってみたいと思います。

- (Trigger) ５分に一回ワークフローをタイマー起動する
- (Action)Sharepoint Online のとあるフォルダに格納されているファイルの一覧を取得
- (Action)取得できたファイル数だけループを回す
    - (Action)取得できたファイル情報（JSON）を解析
    - (Action)上記の全ファイルを別の  Sharepoint サイトにコピーする

各トリガーやアクションの１つ１つの実行に対して料金がかかります。
ただしフォルダ内に配置されたファイル数に応じてループが回る数が実行時に決まりますので、当然その内部のアクションの実行回数もその時々によって変わることになります。
またファイルの一覧の取得及びサイト間のファイルコピーには 
[Sharepoint Online 用のコネクタ](https://docs.microsoft.com/ja-jp/connectors/sharepoint/)
を使用していますので、こちらも別料金です。

ワークフロー実装及び実行結果のイメージは下記の様になります。
この時はコピー元のフォルダにファイルが９つ含まれていたことがわかります。

![ワークフローの実行結果](./images/workflow-execution-result.png)

## 机上で見積もってみる

ワークフロー１回分の実行回数を元に単価を積み上げてみると以下の様になります。
なお料金単価に関しては2019年11月時点の従量課金プランの料金表を元に計算しています。

|項目|Action の実行回数|Action の料金|Standard Connector の実行回数|Standard Connector の料金|
|---|---:|---:|---:|---:|
|タイマー起動|1|¥0.003136|0|¥0.0|
|ファイル一覧|1|¥0.003136|1|¥0.014560|
|ループ|1|¥0.003136|0|¥0.0|
|JSON解析|9|¥0.028224|0|¥0.0|
|コピー|9|¥0.028224|9|¥0.13104|
|小計||¥0.065856 ||¥0.145600|
|合計||||¥0.211456|

これが５分間隔で起動することになりますので、全ての実行が正常に稼働したと考えると料金は以下の様になります。（端数は切り捨てています）

|期間|実行回数|料金|
|---|---:|---:|
|５分|1|¥0.21|
|１時間|12|¥1.27|
|１日|288|¥60.90|
|１ヶ月（30日）|8,640|¥1,826.98|
|１年（365日）|105,120|¥54,809.40|

月額1800円となると一番安い
[B1S の Windows 仮想マシン](https://azure.microsoft.com/ja-jp/pricing/details/virtual-machines/windows/)
に
[P10 の管理ディスク](https://azure.microsoft.com/ja-jp/pricing/details/managed-disks/)
をつけたくらいでしょうか。
意外に馬鹿にならない金額ではありますが、逆にいえば Logic Apps 以外で使用するサービスによっては誤差の範囲に収まってしまうと思います。
また、これくらいの金額を見積もるために要した **工数** を考えるとどうでしょうか。
Logic Apps を使用する動機は様々ですが、サーバーレスを使うことで向上したかったはずの **開発生産性** が無駄になってしまう気がしてなりません。

## 机上で見積もってみる

もちろんファイル数が増えたり実行頻度を上げたりすればもっと料金がかかることにはなりますので馬鹿にできる金額でもないと思いますので、
より簡易に短時間で見積るためには、作って実行してしまった方が良いと思います。
そもそもアクションの回数なんてワークフローを実装してみないとわからないですし。


